From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mark Vainomaa <mikroskeem@mikroskeem.eu>
Date: Fri, 19 Apr 2019 18:31:13 +0300
Subject: [PATCH] Add option to ignore certain commands from logging


diff --git a/api/src/main/java/eu/mikroskeem/mikrocord/api/config/MikroCordProxyConfig.java b/api/src/main/java/eu/mikroskeem/mikrocord/api/config/MikroCordProxyConfig.java
index ef1a82dd100dad66676b10fc9cc654bdc4e539c0..ce8ac985963227c49e05e42ed49c5d2e1c0bd415 100644
--- a/api/src/main/java/eu/mikroskeem/mikrocord/api/config/MikroCordProxyConfig.java
+++ b/api/src/main/java/eu/mikroskeem/mikrocord/api/config/MikroCordProxyConfig.java
@@ -2,6 +2,8 @@ package eu.mikroskeem.mikrocord.api.config;
 
 import org.checkerframework.checker.nullness.qual.NonNull;
 
+import java.util.Set;
+
 /**
  * @author Mark Vainomaa
  */
@@ -17,4 +19,10 @@ public interface MikroCordProxyConfig {
      */
     @NonNull
     String getRestartScriptPath();
+
+    /**
+     * @return Commands excluded from logging
+     */
+    @NonNull
+    Set<@NonNull String> getIgnoredLogCommands();
 }
diff --git a/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java b/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java
index 0f3fc6721944c05ad6a3fad775aac0b0bd321c49..435eab1fed4798bae0efa71c583cd5321a6a6b96 100644
--- a/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java
+++ b/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java
@@ -202,6 +202,7 @@ public class PluginManager
             {
                 if ( proxy.getConfig().isLogCommands() )
                 {
+                    if(!proxy.getConfig().getIgnoredLogCommands().contains(split[0].toLowerCase(Locale.ROOT))) // MikroCord - Add option to exclude certain commands from logging
                     proxy.getLogger().log( Level.INFO, "{0} executed command: /{1}", new Object[]
                     {
                         sender.getName(), commandLine
diff --git a/proxy/src/main/java/eu/mikroskeem/mikrocord/conf/MikroCordConfiguration.java b/proxy/src/main/java/eu/mikroskeem/mikrocord/conf/MikroCordConfiguration.java
index 633e3093fad60741db3e72901086644a374af8a4..000a9861436fa8777c8d18c0654454235d9cb093 100644
--- a/proxy/src/main/java/eu/mikroskeem/mikrocord/conf/MikroCordConfiguration.java
+++ b/proxy/src/main/java/eu/mikroskeem/mikrocord/conf/MikroCordConfiguration.java
@@ -1,10 +1,14 @@
 package eu.mikroskeem.mikrocord.conf;
 
+import com.google.common.collect.ImmutableList;
 import io.github.waterfallmc.waterfall.conf.WaterfallConfiguration;
 import lombok.Getter;
 import net.md_5.bungee.api.ProxyServer;
 import net.md_5.bungee.api.config.ConfigurationAdapter;
 
+import java.util.HashSet;
+import java.util.Set;
+
 /**
  * @author Mark Vainomaa
  */
@@ -15,6 +19,9 @@ public class MikroCordConfiguration extends WaterfallConfiguration {
     @Getter
     private String restartScriptPath = "./restart.sh";
 
+    @Getter
+    private Set<String> ignoredLogCommands;
+
     @Override
     public void load() {
         super.load();
@@ -23,5 +30,6 @@ public class MikroCordConfiguration extends WaterfallConfiguration {
 
         restartMessage = config.getString("restart.message", restartMessage);
         restartScriptPath = config.getString("restart.script_path", restartScriptPath);
+        ignoredLogCommands = new HashSet<>(config.getList("log.ignored_commands", () -> ImmutableList.of("login", "register", "changepassword")));
     }
 }
